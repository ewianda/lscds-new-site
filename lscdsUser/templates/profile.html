{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}

{% load form_utils %}
{% load lscds_tags %}

{% block title %} Account Profile{% endblock %}


{% block main %}


<h1>Welcome {{user.get_full_name}}</h1>
<div class='row'>
<div class='col-md-6'>
<legend>Your profile</legend>
            

<table id="user" class="table table-bordered table-striped">
    <tbody> 
 <tr> <td style="width: 100px"> Email:</td>  <td> {{ object.email}}   </td>  <tr> 





        {% for field in form %}
        <tr> 
{% if field|is_select %}
    <td style="width: 100px">     {{ field.errors }}
        {{ field.label_tag }}</td>
    <td> <a href="#" class="myeditable" data-type="select" data-name="{{field.name}}" data-source ='{{field|select_options}}'>{{ field|value_text}}  </a><i class="icon-pencil pencil-input-change"></i> </td>
{% elif field|is_checkbox %}
  <td style="width: 100px">     {{ field.errors }}
        {{ field.label_tag }}</td>

<td class="myeditable" > {{field}}</td>
{% else %}
{% endif %}

 </tr> 

        {% endfor %}

</tbody>
</table>
<div>
    <button id="save-btn" class="btn btn-primary">Update Profile</button>
 </div>



</div> <!-- End of col-6  -->
<div class='col-md-6'>
<div class='col-md-12'>
<legend>Your event registrations</legend>

{% for event in  registered_list %}
<ul>
    <li>{{event.event.name}}
           <form class="registration"  action="." method="post">
            {% csrf_token %}
            <input type="hidden" name="event_id" value="{{event.event.pk}}">
            <input type="submit" value="Cancel registration" class="submit" />
        </form>
        </li>
</ul> 

    {% empty %}
    No event in this category

    {% endfor %}
</div> <!-- End of col-12  -->
<div class='col-md-12'>
<legend>Upcoming events</legend>

{% for event in  not_registered_list %}
<ul>
    <li>{{event.name}}</li>
           <form class="registration"  action="." method="post">
            {% csrf_token %}
            <input type="hidden" name="event_id" value="{{event.pk}}">
            <input type="submit" value="Register for this event" class="submit" />
        </form>
    </span>
</ul>


    {% empty %}
    No event in this category

    {% endfor %}

</div> <!-- End of col-12  -->

</div> <!-- End of col-6  -->



</div> <!-- End of row-->




{% endblock %}

{% block javascript %}
<script type="text/javascript">
jQuery(document).ready(function() {
$('.registration').on('submit',function(e){
e.preventDefault()
var url = $(this).attr('action')
$.ajax({
type: "POST",
url: url,
data: $(this).serialize(), // serializes the form's elements.
success: function(data)
{
//alert(data); // show response from the php script.

}
}); /// end ajax call
}); // end form submission

// In line editting
$.fn.editable.defaults.mode = 'inline';
$('.myeditable').editable({
placement: 'right',
validate: function(v) {
   if(!v) return 'Required field!';
   }
   });

$('.icon-pencil').click(function(e){    
       e.stopPropagation();
      //$(this).closest($('.myeditable').editable('toggle'));
    $var = $(this).closest('td').find('.editable')
    $var.editable('toggle')
    console.log($var)
    $('.icon-pencil').hide();
});
// Show the pencil on click
  $(document).on('click', '.editable-cancel, .editable-submit', 'body', function(){
        $('.icon-pencil').show();
        }) 


//create new user
$('#save-btn').click(function() {
                     var data=[]
var array = {}

                     $('a.myeditable').each(function(){

                                            array[$(this).attr('data-name')]=$(this).text()
                                            data.push(array)      
                                                                                   })  
     console.log(JSON.stringify(array))


}); 

 }); // End of doccument ready
                       </script>
 {% endblock %}
